(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-14bffd79"],{"1dba":function(e,t,n){"use strict";var a=n("a355"),r=n.n(a);r.a},"91dd":function(e,t,n){"use strict";function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,o){t=t||"&",n=n||"=";var i={};if("string"!==typeof e||0===e.length)return i;var s=/\+/g;e=e.split(t);var c=1e3;o&&"number"===typeof o.maxKeys&&(c=o.maxKeys);var d=e.length;c>0&&d>c&&(d=c);for(var u=0;u<d;++u){var l,h,f,p,m=e[u].replace(s,"%20"),_=m.indexOf(n);_>=0?(l=m.substr(0,_),h=m.substr(_+1)):(l=m,h=""),f=decodeURIComponent(l),p=decodeURIComponent(h),a(i,f)?r(i[f])?i[f].push(p):i[f]=[i[f],p]:i[f]=p}return i};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},"9a87":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("GenSmithKey")],1)},r=[],o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-container",{attrs:{fluid:""}},[n("v-layout",{attrs:{"justify-center":""}},[n("video",{ref:"video",attrs:{id:"video",width:e.display_size.width,height:e.display_size.height,autoplay:""},on:{play:e.detect_and_draw_faces}}),n("canvas",{ref:"canvas",attrs:{id:"canvas",width:e.display_size.width,height:e.display_size.height}}),n("canvas",{ref:"canvas_capture",attrs:{id:"canvas_capture",width:e.display_size.width,height:e.display_size.height}})]),n("v-layout",{style:{"margin-top":e.margin_top}}),n("v-layout",{attrs:{"justify-center":""}},[n("v-flex",{attrs:{xs2:""}},[n("v-text-field",{attrs:{label:"Your name here:"},model:{value:e.user_name,callback:function(t){e.user_name=t},expression:"user_name"}})],1),n("v-flex",{attrs:{xs1:""}},[n("v-btn",{attrs:{round:"",color:"primary",disabled:!e.detected||""===e.user_name},on:{click:e.take_photo_and_upload}},[n("v-icon",[e._v("camera_alt")]),e._v("Take photo\n        ")],1)],1)],1),n("v-layout",{attrs:{"justify-center":""}},[n("v-flex",{attrs:{xs8:""}},[e._e()],1)],1)],1)],1)},i=[],s=(n("7f7f"),n("96cf"),n("3b8d")),c=(n("ac6a"),n("5df3"),n("92c3")),d=n.n(c),u=(n("1e3f"),n("21a6")),l=n.n(u),h=(n("b383"),n("ab39")),f={name:"upload_download",components:{vueDropzone:d.a},data:function(){return{dropzoneOptions:{url:this.$API_URL+"/generate_smith_key",addRemoveLinks:!0,thumbnailWidth:150,maxFilesize:.5,maxFiles:1},display_size:{width:640,height:480},margin_top:"0px",detections:void 0,user_name:""}},computed:{detected:function(){return!!this.detections},session_id:function(){return this.$store.state.session_id}},mounted:function(){this.load_faceapi_models(),this.start_video(),this.find_margin()},methods:{find_margin:function(){this.margin_top=String(this.display_size.height+20)+"px"},start_video:function(){navigator.getUserMedia({video:{}},function(e){return video.srcObject=e},function(e){return console.error(e)})},load_faceapi_models:function(){Promise.all([h["e"].tinyFaceDetector.loadFromUri("/models"),h["e"].faceLandmark68Net.loadFromUri("/models"),h["e"].faceExpressionNet.loadFromUri("/models")]).then(console.log("model loaded"))},detect_and_draw_faces:function(){console.log("start detecting faces");var e=this;setInterval(Object(s["a"])(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,h["b"](e.$refs.video,new h["a"]).withFaceLandmarks();case 2:e.detections=t.sent,e.detected?(n=h["f"](e.detections,e.display_size),e.detections=n,e.draw_face_box()):e.$refs.canvas.getContext("2d").clearRect(0,0,canvas.width,canvas.height);case 4:case"end":return t.stop()}},t)})),e.refresh_time)},draw_face_box:function(){var e=this.$refs.canvas;e.getContext("2d").clearRect(0,0,e.width,e.height);var t=this.detections.detection.box,n={x:e.width-t.x-t.width,y:t.y,width:t.width,height:t.height},a="Hello, Please type your name first";""!==this.user_name&&(a="Hello "+this.user_name+"! Press save to generate your key!");var r={label:a,lineWidth:4,boxColor:"rgba(57,255,20,0.8)"},o=new h["c"].DrawBox(n,r);o.draw(e)},take_photo_and_upload:function(){var e=this;if(e.detected){var t=e.$refs.canvas_capture,n=t.getContext("2d");n.clearRect(0,0,t.width,t.height);var a=e.detections.detection.box;a.width;n.drawImage(e.$refs.video,a.x,a.y,a.width,a.height,a.x,a.y,a.width,a.height);var r=[a.top,a.right,a.bottom,a.left];e.$refs.canvas_capture.toBlob(function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(n){var a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:a=new FormData,a.append("file",n,"known_face.jpg"),a.append("user_name",e.user_name),a.append("session_id",e.session_id),a.append("face_location",r),e.axios({url:e.$API_URL+"/generate_smith_key",method:"POST",data:a}).then(function(t){console.log("downloading .smith key");var n=JSON.stringify(t.data),a=new Blob([n],{type:"application/json"});l.a.saveAs(a,e.user_name+".smith"),location.reload()});case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},upload_photo:function(e,t,n){n.append("session_id",this.session_id),n.append("user_name",this.user_name)},remove_file:function(e){!0!==this.$refs.myVueDropzone.dropzone.disabled&&(console.log("remove file"),this.axios({url:this.$API_URL+"/generate_smith_key",method:"POST",data:{remove_file:e["name"]}}).then(function(e){}))}}},p=f,m=(n("1dba"),n("2877")),_=Object(m["a"])(p,o,i,!1,null,"5e8bc98a",null),v=_.exports,y={name:"face",components:{GenSmithKey:v},mounted:function(){},methods:{}},g=y,w=Object(m["a"])(g,a,r,!1,null,null,null);t["default"]=w.exports},a355:function(e,t,n){},b383:function(e,t,n){"use strict";t.decode=t.parse=n("91dd"),t.encode=t.stringify=n("e099")},e099:function(e,t,n){"use strict";var a=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"===typeof e?o(i(e),function(i){var s=encodeURIComponent(a(i))+n;return r(e[i])?o(e[i],function(e){return s+encodeURIComponent(a(e))}).join(t):s+encodeURIComponent(a(e[i]))}).join(t):s?encodeURIComponent(a(s))+n+encodeURIComponent(a(e)):""};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var n=[],a=0;a<e.length;a++)n.push(t(e[a],a));return n}var i=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}}}]);
//# sourceMappingURL=chunk-14bffd79.757d2c17.js.map